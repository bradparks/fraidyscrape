#!/usr/bin/env node
const fetch = require('node-fetch')
const fraidyscrape = require('..')
const fs = require('fs')
const dom = require('xmldom').DOMParser;

(async function () {
  var url = process.argv[3], req
  var scraper = new fraidyscrape(JSON.parse(fs.readFileSync(process.argv[2])), new dom())
  var tasks = scraper.detect(url)
  console.log(tasks)

  while (req = scraper.nextRequest(tasks)) {
		console.log(req)
		let res = await fetch(req.url, req.options)
		// console.log(res)
		let obj = await scraper.scrape(tasks, req, res)
		console.log(obj.out)
  }
})();
